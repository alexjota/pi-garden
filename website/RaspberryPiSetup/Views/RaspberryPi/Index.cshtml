
@{
    ViewBag.Title = "Commands";
}

<h2>Send commands to your device</h2>

<h3>My RaspberryPi IP is: @ViewBag.Ip</h3>

<div id="alert" class="alert alert-info" style="display:none">
    <span id="alert-content"></span>
</div>

<div>
    @using (Html.BeginForm("connect", "raspberrypi", FormMethod.Post))
    {
        <button type="submit" class="btn btn-default">Connect to Facebook</button>
    }

    @if (ViewBag.Code != null)
    {
        <h3>Your login code is: @ViewBag.Code</h3>
        }
</div>
<br />
<div>
    @using (Html.BeginForm("postText", "raspberrypi", FormMethod.Post, new { @class="form-inline" }))
    {
        <button type="submit" class="btn btn-default">Post some text</button>
        <input type="text" name="message" class="form-control" />
    }

</div>
<br />
<div>
    @using (Html.BeginForm("postPhoto", "raspberrypi", FormMethod.Post))
    {
    <button type="submit" class="btn btn-default">Post Photo</button>
    }

</div>
<br />
<div>
    @using (Html.BeginForm("lightOn", "raspberrypi", FormMethod.Post))
    {
    <button type="submit" class="btn btn-default">Turn light on</button>
    }

</div>
<br />
<div>
    @using (Html.BeginForm("lightOff", "raspberrypi", FormMethod.Post))
    {
    <button type="submit" class="btn btn-default">Turn light off</button>
    }
</div>


@section scripts{
    <!--Script references. -->
    <!--Reference the SignalR library. -->
    <script src="Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">
    $(document).ready(function () {
        var deferred;

        // Declare a proxy to reference the hub.
        var alerts = $.connection.alertsHub;

        // Create a function that the hub can call to broadcast messages.
        alerts.client.alertReceived = function (message) {
            var alertMessage = $("#alert");

            if (deferred && !deferred.state() == "resolved") {
                deferred.reject();
            }
            else {
                $("#alert-content").text(message);
                alertMessage.fadeIn();
            }

            deferred = $.Deferred();
            deferred.done(function () {
                alertMessage.fadeOut();
            })

            setTimeout(function () {
                deferred.resolve();
            }, 4000)
        };

        // Start the connection.
        $.connection.hub.url = "http://localhost:63641/signalr";
        $.connection.hub.start()
            .done(function () { alert("connected!"); })
            .fail(function (error) { alert("error"); });
    });
    </script>
}